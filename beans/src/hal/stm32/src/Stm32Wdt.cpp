// ***************************************************************************
// TITLE
//
// PROJECT
//
// ***************************************************************************
//
// FILE
//      $Id$
// HISTORY
//      $Log$
// ***************************************************************************

#include <Watchdog.h>

#include <customboard.h>

#include <Hal.h>
#include <HalPlatformDefs.h>

// ---------------------------------------------------------------------------
// ------------------------------- DEFINITIONS -------------------------------
// -----|-------------------|-------------------------------------------------

// ---------------------------------------------------------------------------
// ---------------------------------- DATA -----------------------------------
// -----|-------------------|-------------------------------------------------

static  IWDG_HandleTypeDef  hiwdg;

// ---------------------------------------------------------------------------
// -------------------------------- FUNCTIONS --------------------------------
// -----------------|---------------------------(|------------------|---------

// ***************************************************************************
// TYPE
//      Constructor
// FUNCTION
//      Watchdog::Watchdog
// PURPOSE
//      Class construction
// PARAMETERS
//          --
// ***************************************************************************
Watchdog::Watchdog()
{
}
// ***************************************************************************
// FUNCTION
//      Watchdog::start
// PURPOSE
//
// PARAMETERS
//      UINT timeout --
// RESULT
//      BOOL
//            TRUE:   Ok
//            FALSE:  Error
// ***************************************************************************
BOOL Watchdog::start(UINT           timeout)
{
    BOOL            result          = true;

    ENTER(true);

    hiwdg.Instance = IWDG;
    hiwdg.Init.Prescaler = IWDG_PRESCALER_256;

#if (defined(__STM32L4xx_LL_IWDG_H) || defined(STM32F7xx_HAL_IWDG_H))
    hiwdg.Init.Window = timeout;
#endif

    hiwdg.Init.Reload = timeout;

    HAL_IWDG_Init(&hiwdg);

    RETURN(result);
}
// ***************************************************************************
// FUNCTION
//      Watchdog::feed
// PURPOSE
//
// PARAMETERS
//          --
// RESULT
//      void --
// ***************************************************************************
void Watchdog::feed()
{
    HAL_IWDG_Refresh(&hiwdg);
}
// ***************************************************************************
// FUNCTION
//      Watchdog::stop
// PURPOSE
//
// PARAMETERS
//          --
// RESULT
//      void --
// ***************************************************************************
void Watchdog::stop()
{
}
